<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:tns="http://www.magenta-aps.dk/oewf" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" expressionLanguage="http://www.w3.org/1999/XPath" id="m1429627621525" name="" targetNamespace="http://www.magenta-aps.dk/oewf" typeLanguage="http://www.w3.org/2001/XMLSchema">
  <process id="openE-qa-and-approval" isClosed="false" isExecutable="true" name="Kvalitetssikring og godkendelsesopgave" processType="None">
    <documentation id="openE-qa-and-approval_D_1"><![CDATA[Place documentation for the 'qa-and-approval' process here.]]></documentation>
    <startEvent activiti:formKey="oewf:submitQAApprovalTask" id="QA-Approval-Task" name="Kvalitetssikring og godkendelsesopgave"/>
    <userTask activiti:exclusive="true" activiti:formKey="oewf:qaEdit" id="qaaEditProduct" name="Rediger produkt">
      <extensionElements>
        <activiti:taskListener class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener" event="create">
          <activiti:field name="script">
            <activiti:string>
                if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate;
                if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
            </activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener" event="complete">
          <activiti:field name="script">
            <activiti:string>
                /*

		// get documents
		var bpm_package =  task.getVariable('bpm_package')
		logger.log("*********************** hvad er bpm_package ******************** " + bpm_package );
                logger.log("*********************** hvad er bpm_package.children ******************** " + bpm_package.children );

		// set metadata on all documents
		for (var x in bpm_package.children) {
		   logger.log("nodref: " + bpm_package.children[x].nodeRef);


		   if (bpm_package.children[x].properties["oe:producent"] == null) {
		       bpm_package.children[x].properties["oe:producent"] = new Array();
		       bpm_package.children[x].properties["oe:producent"].push(person);
		   }
		   else {
		       bpm_package.children[x].properties["oe:producent"].push(person);
		   }

		   bpm_package.children[x].save();
		}
                */
</activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow1" sourceRef="QA-Approval-Task" targetRef="qaaEditProduct"/>
    <userTask activiti:exclusive="true" activiti:formKey="oewf:qaaQTask" id="qaaTask" name="Kvalitetssikring">
      <extensionElements>
        <activiti:taskListener class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener" event="complete">
          <activiti:field name="script">
            <activiti:string>
                execution.setVariable('bpm_assignee', person);
                execution.setVariable('oewf_qaaQTaskOutcome', task.getVariable('oewf_qaaQTaskOutcome'));

                /*

                var t = execution.getVariable('oewf_qaaQTaskOutcome');
                if (t == 'Ja') {
                  // set metadata on all documents
                  for (var x in bpm_package.children) {
                     logger.log("nodref: " + bpm_package.children[x].nodeRef);


                     if (bpm_package.children[x].properties["oe:kvalitetssikring"] == null) {
                         bpm_package.children[x].properties["oe:kvalitetssikring"] = new Array();
                         bpm_package.children[x].properties["oe:kvalitetssikring"].push(person);
                     }
                     else {
                         bpm_package.children[x].properties["oe:kvalitetssikring"].push(person);
                     }

                     bpm_package.children[x].save();
                  }
                }

                */
            </activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow2" sourceRef="qaaEditProduct" targetRef="qaaTask"/>
    <exclusiveGateway gatewayDirection="Unspecified" id="qaaTaskDe" name="Approved?"/>
    <sequenceFlow id="flow3" sourceRef="qaaTask" targetRef="qaaTaskDe"/>
    <sequenceFlow id="flow4" sourceRef="qaaTaskDe" targetRef="qaaEditProduct">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${oewf_qaaQTaskOutcome == 'Nej'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow5" sourceRef="qaaTaskDe" targetRef="qaaApprovalTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${oewf_qaaQTaskOutcome == 'Ja'}]]></conditionExpression>
    </sequenceFlow>
    <userTask activiti:exclusive="true" activiti:formKey="oewf:qaaATask" id="qaaApprovalTask" name="Godkend">
      <extensionElements>
        <activiti:taskListener class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener" event="complete">
          <activiti:field name="script">
            <activiti:string>
                execution.setVariable('bpm_assignee', person);
                execution.setVariable('oewf_qaaATaskOutcome', task.getVariable('oewf_qaaATaskOutcome'));
                task.setVariable('oewf_isLastTask', true);

                /*


                var t = execution.getVariable('oewf_qaaQTaskOutcome');
                if (t == 'Ja') {
                  // set metadata on all documents
                  for (var x in bpm_package.children) {
                     logger.log("nodref: " + bpm_package.children[x].nodeRef);

                     if (bpm_package.children[x].properties["oe:godkendelse"] == null) {
                         bpm_package.children[x].properties["oe:godkendelse"] = new Array();
                         bpm_package.children[x].properties["oe:godkendelse"].push(person);
                     }
                     else {
                         bpm_package.children[x].properties["oe:godkendelse"].push(person);
                     }

                     bpm_package.children[x].save();
                  }
                }
                */
            </activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <exclusiveGateway gatewayDirection="Unspecified" id="qaaApprovalTaskDecision" name="Approved?"/>
    <sequenceFlow id="flow6" sourceRef="qaaApprovalTask" targetRef="qaaApprovalTaskDecision"/>
    <sequenceFlow id="flow7" sourceRef="qaaApprovalTaskDecision" targetRef="qaaEditProduct">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${oewf_qaaATaskOutcome == 'Nej'}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="flow8" sourceRef="qaaApprovalTaskDecision" targetRef="endevent1">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${oewf_qaaATaskOutcome == 'Ja'}]]></conditionExpression>
    </sequenceFlow>
    <endEvent id="endevent1" name="End"/>
  </process>
  <bpmndi:BPMNDiagram documentation="background=#3C3F41;count=1;horizontalcount=1;orientation=0;width=842.4;height=1195.2;imageableWidth=832.4;imageableHeight=1185.2;imageableX=5.0;imageableY=5.0" id="Diagram-_1" name="New Diagram">
    <bpmndi:BPMNPlane bpmnElement="openE-qa-and-approval">
      <bpmndi:BPMNShape bpmnElement="QA-Approval-Task" id="Shape-QA-Approval-Task">
        <omgdc:Bounds height="32.0" width="32.0" x="120.0" y="290.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="32.0" width="32.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="qaaEditProduct" id="Shape-qaaEditProduct">
        <omgdc:Bounds height="55.0" width="105.0" x="200.0" y="280.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="55.0" width="105.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="qaaTask" id="Shape-qaaTask">
        <omgdc:Bounds height="55.0" width="105.0" x="360.0" y="280.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="55.0" width="105.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="qaaTaskDe" id="Shape-qaaTaskDe" isMarkerVisible="false">
        <omgdc:Bounds height="32.0" width="32.0" x="520.0" y="287.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="32.0" width="32.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="qaaApprovalTask" id="Shape-qaaApprovalTask">
        <omgdc:Bounds height="55.0" width="105.0" x="488.0" y="353.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="55.0" width="105.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="qaaApprovalTaskDecision" id="Shape-qaaApprovalTaskDecision" isMarkerVisible="false">
        <omgdc:Bounds height="32.0" width="32.0" x="640.0" y="360.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="32.0" width="32.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="Shape-endevent1">
        <omgdc:Bounds height="32.0" width="32.0" x="720.0" y="319.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="32.0" width="32.0" x="0.0" y="0.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3" sourceElement="qaaTask" targetElement="qaaTaskDe">
        <omgdi:waypoint x="465.0" y="307.5"/>
        <omgdi:waypoint x="520.0" y="303.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2" sourceElement="qaaEditProduct" targetElement="qaaTask">
        <omgdi:waypoint x="305.0" y="307.5"/>
        <omgdi:waypoint x="360.0" y="307.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5" sourceElement="qaaTaskDe" targetElement="qaaApprovalTask">
        <omgdi:waypoint x="536.0" y="319.0"/>
        <omgdi:waypoint x="536.0" y="353.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4" sourceElement="qaaTaskDe" targetElement="qaaEditProduct">
        <omgdi:waypoint x="540.0" y="291.0"/>
        <omgdi:waypoint x="540.0" y="235.0"/>
        <omgdi:waypoint x="252.0" y="235.0"/>
        <omgdi:waypoint x="252.5" y="280.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1" sourceElement="QA-Approval-Task" targetElement="qaaEditProduct">
        <omgdi:waypoint x="152.0" y="306.0"/>
        <omgdi:waypoint x="200.0" y="307.5"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7" sourceElement="qaaApprovalTaskDecision" targetElement="qaaEditProduct">
        <omgdi:waypoint x="660.0" y="388.0"/>
        <omgdi:waypoint x="660.0" y="464.0"/>
        <omgdi:waypoint x="252.0" y="464.0"/>
        <omgdi:waypoint x="252.5" y="335.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6" sourceElement="qaaApprovalTask" targetElement="qaaApprovalTaskDecision">
        <omgdi:waypoint x="593.0" y="380.5"/>
        <omgdi:waypoint x="640.0" y="376.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8" sourceElement="qaaApprovalTaskDecision" targetElement="endevent1">
        <omgdi:waypoint x="660.0" y="364.0"/>
        <omgdi:waypoint x="660.0" y="336.0"/>
        <omgdi:waypoint x="720.0312805773287" y="336.0"/>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="-1.0" width="-1.0" x="-1.0" y="-1.0"/>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
